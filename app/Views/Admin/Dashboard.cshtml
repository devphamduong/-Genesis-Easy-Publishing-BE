
<div class="panel-header bg-primary-gradient">
	<div class="page-inner py-5">
		<div class="d-flex align-items-left align-items-md-center flex-column flex-md-row">
			<div>
				<h2 class="text-white pb-2 fw-bold">Dashboard</h2>
			</div>
		</div>
	</div>
</div>
<div class="page-inner mt--5">
	<div class="row row-card-no-pd mt--2">
		<div class="col-sm-6 col-md-4">
			<div class="card card-stats card-round">
				<div class="card-body ">
					<div class="row">
						<div class="col-5">
							<div class="icon-big text-center">
								<i class="flaticon-chart-pie text-warning"></i>
							</div>
						</div>
						<div class="col-7 col-stats">
							<div class="numbers">
								<p class="card-category">Số lượng truyện</p>
								<h4 class="card-title" id="numberOfStories">20</h4>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-sm-6 col-md-4">
			<div class="card card-stats card-round">
				<div class="card-body ">
					<div class="row">
						<div class="col-4">
							<div class="icon-big text-center">
								<i class="flaticon-coins text-success"></i>
							</div>
						</div>
						<div class="col-8 col-stats">
							<div class="numbers">
								<p class="card-category">Doanh thu tổng</p>
								<h4 class="card-title" id="overallRevenue">0 ₫</h4>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-sm-6 col-md-4">
			<div class="card card-stats card-round">
				<div class="card-body">
					<div class="row">
						<div class="col-5">
							<div class="icon-big text-center">
								<i class="flaticon-user-5 text-primary"></i>
							</div>
						</div>
						<div class="col-7 col-stats">
							<div class="numbers">
								<p class="card-category">Số lượng tác giả</p>
								<h4 class="card-title" id="numberOfAuthor">23</h4>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-8">
			<div class="card">
				<div class="card-header">
					<div class="card-head-row">
						<div class="card-title">Doanh thu 7 ngày qua</div>
						<div class="card-tools">
							<a href="#" class="btn btn-info btn-border btn-round btn-sm mr-2">
								<span class="btn-label">
									<i class="fa fa-pencil"></i>
								</span>
								Export
							</a>
							<a href="#" class="btn btn-info btn-border btn-round btn-sm">
								<span class="btn-label">
									<i class="fa fa-print"></i>
								</span>
								Print
							</a>
						</div>
					</div>
				</div>
				<div class="card-body">
					<div class="chart-container" style="min-height: 375px">
						<canvas id="statisticsChart"></canvas>
					</div>
					<div id="myChartLegend"></div>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card card-primary">
				<div class="card-header">
					<div class="card-title">Doanh thu hôm nay</div>
				</div>
				<div class="card-body pb-0">
					<div class="mb-4 mt-2">
						<h1 id="todaySale">0 ₫</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-4">
			<div class="card">
				<div class="card-body pb-0">
					<div class="h1 fw-bold float-right text-primary">+5%</div>
					<h2 class="mb-2">17</h2>
					<p class="text-muted">Users online</p>
					<div class="pull-in sparkline-fix">
						<div id="lineChart"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card">
				<div class="card-body pb-0">
					<div class="h1 fw-bold float-right text-danger">-3%</div>
					<h2 class="mb-2">27</h2>
					<p class="text-muted">New Users</p>
					<div class="pull-in sparkline-fix">
						<div id="lineChart2"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card">
				<div class="card-body pb-0">
					<div class="h1 fw-bold float-right text-warning">+7%</div>
					<h2 class="mb-2">213</h2>
					<p class="text-muted">Transactions</p>
					<div class="pull-in sparkline-fix">
						<div id="lineChart3"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-4">
			<div class="card">
				<div class="card-header">
					<div class="card-title">Top Products</div>
				</div>
				<div class="card-body pb-0">
					<div class="d-flex">
						<div class="avatar">
							<img src="../assets/img/logoproduct.svg" alt="..." class="avatar-img rounded-circle">
						</div>
						<div class="flex-1 pt-1 ml-2">
							<h6 class="fw-bold mb-1">CSS</h6>
							<small class="text-muted">Cascading Style Sheets</small>
						</div>
						<div class="d-flex ml-auto align-items-center">
							<h3 class="text-info fw-bold">+$17</h3>
						</div>
					</div>
					<div class="separator-dashed"></div>
					<div class="d-flex">
						<div class="avatar">
							<img src="../assets/img/logoproduct.svg" alt="..." class="avatar-img rounded-circle">
						</div>
						<div class="flex-1 pt-1 ml-2">
							<h6 class="fw-bold mb-1">J.CO Donuts</h6>
							<small class="text-muted">The Best Donuts</small>
						</div>
						<div class="d-flex ml-auto align-items-center">
							<h3 class="text-info fw-bold">+$300</h3>
						</div>
					</div>
					<div class="separator-dashed"></div>
					<div class="d-flex">
						<div class="avatar">
							<img src="../assets/img/logoproduct3.svg" alt="..." class="avatar-img rounded-circle">
						</div>
						<div class="flex-1 pt-1 ml-2">
							<h6 class="fw-bold mb-1">Ready Pro</h6>
							<small class="text-muted">Bootstrap 4 Admin Dashboard</small>
						</div>
						<div class="d-flex ml-auto align-items-center">
							<h3 class="text-info fw-bold">+$350</h3>
						</div>
					</div>
					<div class="separator-dashed"></div>
					<div class="pull-in">
						<canvas id="topProductsChart"></canvas>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card">
				<div class="card-body">
					<div class="card-title fw-mediumbold">Suggested People</div>
					<div class="card-list">
						<div class="item-list">
							<div class="avatar">
								<img src="../assets/img/jm_denis.jpg" alt="..." class="avatar-img rounded-circle">
							</div>
							<div class="info-user ml-3">
								<div class="username">Jimmy Denis</div>
								<div class="status">Graphic Designer</div>
							</div>
							<button class="btn btn-icon btn-primary btn-round btn-xs">
								<i class="fa fa-plus"></i>
							</button>
						</div>
						<div class="item-list">
							<div class="avatar">
								<img src="../assets/img/chadengle.jpg" alt="..." class="avatar-img rounded-circle">
							</div>
							<div class="info-user ml-3">
								<div class="username">Chad</div>
								<div class="status">CEO Zeleaf</div>
							</div>
							<button class="btn btn-icon btn-primary btn-round btn-xs">
								<i class="fa fa-plus"></i>
							</button>
						</div>
						<div class="item-list">
							<div class="avatar">
								<img src="../assets/img/talha.jpg" alt="..." class="avatar-img rounded-circle">
							</div>
							<div class="info-user ml-3">
								<div class="username">Talha</div>
								<div class="status">Front End Designer</div>
							</div>
							<button class="btn btn-icon btn-primary btn-round btn-xs">
								<i class="fa fa-plus"></i>
							</button>
						</div>
						<div class="item-list">
							<div class="avatar">
								<img src="../assets/img/mlane.jpg" alt="..." class="avatar-img rounded-circle">
							</div>
							<div class="info-user ml-3">
								<div class="username">John Doe</div>
								<div class="status">Back End Developer</div>
							</div>
							<button class="btn btn-icon btn-primary btn-round btn-xs">
								<i class="fa fa-plus"></i>
							</button>
						</div>
						<div class="item-list">
							<div class="avatar">
								<img src="../assets/img/talha.jpg" alt="..." class="avatar-img rounded-circle">
							</div>
							<div class="info-user ml-3">
								<div class="username">Talha</div>
								<div class="status">Front End Designer</div>
							</div>
							<button class="btn btn-icon btn-primary btn-round btn-xs">
								<i class="fa fa-plus"></i>
							</button>
						</div>
						<div class="item-list">
							<div class="avatar">
								<img src="../assets/img/jm_denis.jpg" alt="..." class="avatar-img rounded-circle">
							</div>
							<div class="info-user ml-3">
								<div class="username">Jimmy Denis</div>
								<div class="status">Graphic Designer</div>
							</div>
							<button class="btn btn-icon btn-primary btn-round btn-xs">
								<i class="fa fa-plus"></i>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card card-primary bg-primary-gradient">
				<div class="card-body">
					<h4 class="mt-3 b-b1 pb-2 mb-4 fw-bold">Active user right now</h4>
					<h1 class="mb-4 fw-bold">17</h1>
					<h4 class="mt-3 b-b1 pb-2 mb-5 fw-bold">Page view per minutes</h4>
					<div id="activeUsersChart"></div>
					<h4 class="mt-5 pb-3 mb-0 fw-bold">Top active pages</h4>
					<ul class="list-unstyled">
						<li class="d-flex justify-content-between pb-1 pt-1"><small>/product/readypro/index.html</small> <span>7</span></li>
						<li class="d-flex justify-content-between pb-1 pt-1"><small>/product/atlantis/demo.html</small> <span>10</span></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	document.addEventListener("DOMContentLoaded", function () {
		$('#lineChart').sparkline([102, 109, 120, 99, 110, 105, 115], {
			type: 'line',
			height: '70',
			width: '100%',
			lineWidth: '2',
			lineColor: '#177dff',
			fillColor: 'rgba(23, 125, 255, 0.14)'
		});

		$('#lineChart2').sparkline([99, 125, 122, 105, 110, 124, 115], {
			type: 'line',
			height: '70',
			width: '100%',
			lineWidth: '2',
			lineColor: '#f3545d',
			fillColor: 'rgba(243, 84, 93, .14)'
		});

		$('#lineChart3').sparkline([105, 103, 123, 100, 95, 105, 115], {
			type: 'line',
			height: '70',
			width: '100%',
			lineWidth: '2',
			lineColor: '#ffa534',
			fillColor: 'rgba(255, 165, 52, .14)'
		});
		loadData();

	});
	
	async function loadData() {
		//revenue in 7 days
		fetch('http://localhost:5188/api/v1/transaction/getRevenue')
			.then(response => response.json())
			.then(data => {
				createWeekRevenueChart(data.dt.labels, data.dt.data)
			})
			.catch(error => {
				console.error('Error fetching data:', error);
			});
		// today revenu
		fetch('http://localhost:5188/api/v1/transaction/getTodayRevenue')
			.then(response => response.json())
			.then(data => {
				const todaySale = data.dt; // Get the last item in the data array
				document.getElementById('todaySale').textContent = `${todaySale.toLocaleString('vi-VN')} ₫`;
			})
			.catch(error => {
				console.error('Error fetching data:', error);
			});

		// overallRevenue
		fetch('http://localhost:5188/api/v1/transaction/getOverallRevenue')
			.then(response => response.json())
			.then(data => {
				const overallRevenue = data.dt; 
				document.getElementById('overallRevenue').textContent = `${overallRevenue.toLocaleString('vi-VN')} ₫`;
			})
			.catch(error => {
				console.error('Error fetching data:', error);
			});

		//number of stories and authors
		fetch('http://localhost:5188/api/v1/story/getAuthorAndStoryNumber')
			.then(response => response.json())
			.then(data => {
				document.getElementById('numberOfAuthor').textContent = data.dt.authorNumber;
				document.getElementById('numberOfStories').textContent = data.dt.storyNumber;
			})
			.catch(error => {
				console.error('Error fetching data:', error);
			});

	};

	function createWeekRevenueChart(labels, data){
		var ctx = document.getElementById('statisticsChart').getContext('2d');

		var statisticsChart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: labels,
				datasets: [{
					label: "Doanh thu",
					borderColor: '#f3545d',
					pointBackgroundColor: 'rgba(243, 84, 93, 0.6)',
					pointRadius: 0,
					backgroundColor: 'rgba(243, 84, 93, 0.4)',
					legendColor: '#f3545d',
					fill: true,
					borderWidth: 2,
					data: data
				}]
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				legend: {
					display: false
				},
				tooltips: {
					bodySpacing: 4,
					mode: "nearest",
					intersect: 0,
					position: "nearest",
					xPadding: 10,
					yPadding: 10,
					caretPadding: 10,
					callbacks: {
						label: function (tooltipItem, data) {
							var label = data.datasets[tooltipItem.datasetIndex].label || '';
							var value = tooltipItem.yLabel;
							return label + ": " + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ₫"; // Format with commas and append "VND"
						}
					}
				},
				layout: {
					padding: { left: 5, right: 5, top: 15, bottom: 15 }
				},
				scales: {
					yAxes: [{
						ticks: {
							fontStyle: "500",
							beginAtZero: false,
							maxTicksLimit: 7,
							padding: 10,
							callback: function (value, index, values) {
								return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ₫"; // Format with commas and append "VND"
							}
						},
						gridLines: {
							drawTicks: false,
							display: false
						}
					}],
					xAxes: [{
						gridLines: {
							zeroLineColor: "transparent"
						},
						ticks: {
							padding: 10,
							fontStyle: "500"
						}
					}]
				},
				legendCallback: function (chart) {
					var text = [];
					text.push('<ul class="' + chart.id + '-legend html-legend">');
					for (var i = 0; i < chart.data.datasets.length; i++) {
						text.push('<li><span style="background-color:' + chart.data.datasets[i].legendColor + '"></span>');
						if (chart.data.datasets[i].label) {
							text.push(chart.data.datasets[i].label);
						}
						text.push('</li>');
					}
					text.push('</ul>');
					return text.join('');
				}
			}
		});

		var myLegendContainer = document.getElementById("myChartLegend");

		// generate HTML legend
		myLegendContainer.innerHTML = statisticsChart.generateLegend();

		// bind onClick event to all LI-tags of the legend
		var legendItems = myLegendContainer.getElementsByTagName('li');
		for (var i = 0; i < legendItems.length; i += 1) {
			legendItems[i].addEventListener("click", legendClickCallback, false);
		}
	}
</script>